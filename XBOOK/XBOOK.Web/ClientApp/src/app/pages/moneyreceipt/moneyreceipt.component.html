<nb-card style="min-height: 70vh;">
  <nb-card-header>
    <div class="row">
      <div class="col-6">
        <span class="card__title">{{'MONEY.RECEIPT.TITLE' | translate}}</span>
      </div>
      <div class="col-6">
        <button [disabled]="authenticationService.hasPermission('Money Receipt','create')" (click)="createReceipt()" class="btn btn-raised mr-1 btn-success float-right">{{'MONEY.RECEIPT.TITLE.NEW' | translate}}</button>
      </div>
    </div>
  </nb-card-header>
  <nb-card-body>
      <div class="row">
        <div class="col-lg-4 col-md-4 col-6" style="padding-top: 6px;">
          <div class="label-blue">{{'PAYMENT.RECEIPT.ALL.HEADER' | translate}}<span *ngIf="selected.length > 0">> {{'COMMON.SELECTED' | translate}} ({{selected.length}})</span>
          </div>
        </div>
        <div class="col-lg-3 col-md-4 col-6 text-right text-md-left">
          <div ngbDropdown>
            <button class="btn btn-flat mr-1 card__button-bulk-action pr-1" id="bulkActions" ngbDropdownToggle>{{'COMMON.MOREACTION' | translate}}</button>
            <div ngbDropdownMenu aria-labelledby="bulkActions">
              <button class="dropdown-item"><i class="icon-printer"></i>{{'COMMON.ACTION.PRINT' | translate}}</button>
              <button [disabled]="authenticationService.hasPermission('Money Receipt','delete')" (click)="deleteAll()" class="dropdown-item" ><i class="fa fa-trash"></i>{{'COMMON.ACTION.DELETE' | translate}}</button>
            </div>
          </div>
        </div>
        <div class="col-lg-5 col-md-4 col-12 float-right">
          <div class="position-relative has-icon-left input-group">
            <input type="text" [(ngModel)]="keyword" (keyup)="refresh()" name="keyword"  autocomplete="off" class="form-control round pl-4"
              placeholder="{{'COMMON.ACTION.SEARCH' | translate}}">
            <div class="form-control-position" style="right: auto;z-index: 1000;">
              <i class="ft-search" (click)="refresh()"></i>
            </div>
            <input *ngIf="searchForm.valid && isSubmitted" type="text" [(ngModel)]="dateFilters" name="dateFilters"
            autocomplete="off" class="form-control round">
            <div class="input-group-append search-form" ngbDropdown #searchPanel="ngbDropdown">
              <button style="border: 1px solid #A6A9AE" class="btn btn btn-outline mr-1 btn-round" id="btnAdvanceSearch"
                ngbDropdownToggle><i class="ft-calendar"></i></button>
              <div ngbDropdownMenu class="dropdown-menu-right" style="background: #E6EAEC;padding-bottom: 0px"
                aria-labelledby="btnAdvanceSearch">
                <div class="modal-header" style="padding: 0.5rem 0.5rem!important;">
                  <h5 class="modal-title">{{'COMMON.ACTION.SEARCH' | translate}}</h5>
                </div>

                <form autocomplete="off" [formGroup]="searchForm"  (submit)="applySearchFilter(searchForm)" novalidate
                style="background: #fff;" class="form form-horizontal px-2 pb-2 pt-3 width-300">
                  <div class="form-body">
                    <div class="row">
                      <div class="col-md-6">
                        <div class=" input-group">
                          <input  required class="form-control" placeholder="Start" name="startDate" formControlName="startDate"
                            ngbDatepicker #pkStartDate="ngbDatepicker" id="startDate">
                          <div class="input-group-append">
                            <div class="input-group-text" (click)="pkStartDate.toggle()">
                              <i class="fa fa-calendar" style="cursor: pointer;"></i>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="input-group">
                          <input class="form-control" required  placeholder="End" name="endDate" ngbDatepicker formControlName="endDate"
                            #pkEndDate="ngbDatepicker" id="endDate">
                          <div class="input-group-append">
                            <div class="input-group-text" (click)="pkEndDate.toggle()">
                              <i class="fa fa-calendar" style="cursor: pointer;"></i>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    

                  </div>
                  <div class="form-actions right mt-1">
                    <button class="btn btn-raised mr-1 btn-secondary"> <i class="ft-x"></i>{{'COMMON.BUTTON.CLEAR' | translate}}</button>
                    <button type="submit" class="btn btn-raised mr-1 btn-success"><i class="ft-check-square"></i>{{'COMMON.BUTTON.APPLY' | translate}}</button>
                  </div>
                </form>

              </div>
            </div>
          </div>

        </div>
      </div>
      <div class="row">
        <div class="col-md-12">
   
          <ngx-datatable #myTable class="bootstrap hover no-striped flex" [rows]="moneyReceiptList"
          [loadingIndicator]="loadingIndicator" [sorts]="[{prop: 'id', dir: 'desc'}]" [columnMode]="ColumnMode.force"
          [headerHeight]="60" [footerHeight]="100" [rowHeight]="getRowHeight" [reorderable]="reorderable" [limit]="20"
          [selected]="selected" [selectionType]="'checkbox'" (sort)="onSort($event)" (activate)="onActivate($event)"
          (select)='onSelect($event)' [selectAllRowsOnPage]="false" >

          <ngx-datatable-column [width]="50" [sortable]="false" [canAutoResize]="false" [draggable]="false"
            [resizeable]="false">
            <ng-template ngx-datatable-header-template let-value="value" let-allRowsSelected="allRowsSelected"
              let-selectFn="selectFn">
              <div class="custom-control custom-checkbox m-0">
                <input type="checkbox" [checked]="allRowsSelected" id="chkCheckAll1" class="custom-control-input"
                  (change)="selectFn(!allRowsSelected)" />
                <label class="custom-control-label col-form-label" for="chkCheckAll1"></label>
              </div>
            </ng-template>
            <ng-template ngx-datatable-cell-template let-value="value" let-isSelected="isSelected"
              let-onCheckboxChangeFn="onCheckboxChangeFn" let-row="row">
              <div class="custom-control custom-checkbox m-0">
                <input #cb type="checkbox" class="custom-control-input" id="{{row.id}}" [checked]="isSelected"
                  (change)="onCheckboxChangeFn($event)" />
                <label class="custom-control-label col-form-label" for="{{row.id}}"></label>
              </div>
            </ng-template>
          </ngx-datatable-column>
         
          <ngx-datatable-column name="{{'PAYMENT.RECIPT.GRID.HEADER.CLIENT' | translate}}" prop="clientName">
            <ng-template let-row="row" ngx-datatable-cell-template>
              <div class="pr-1">{{row.clientName}}</div>
              <div class="col-more-info font-small-3">{{row.receiptNumber}}</div>
            </ng-template>
          </ngx-datatable-column>
          <ngx-datatable-column prop="note" name="{{'INVOICE.GRID.HEADER.NOTES' | translate}}" [cellClass]="'col-id'" [headerClass]="'col-id'">
            <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
              <div class="col-more-info" style="line-height: inherit;">{{row.note}}</div>
            </ng-template>
          </ngx-datatable-column>
          <ngx-datatable-column prop="issueDate" name="{{'PAYMENT.RECIPT.GRID.HEADER.DATE.BANK' | translate}}" [cellClass]="'col-center'"
            [headerClass]="'col-center'">
            <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
              <div class="col-center">{{row.payDate | date: 'dd/MM/yyyy'}}</div>
              <div class="col-more-info col-center">
                {{row.bankAccount}}
              </div>
            </ng-template>
          </ngx-datatable-column>
          <ngx-datatable-column  prop="amountPaid" name="{{'PAYMENT.RECIPT.GRID.HEADER.AMOUNT.PAYDATE' | translate}}" [cellClass]="'col-right'"
            [headerClass]="'col-right'">
            <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
              <div class="col-right" style="padding-right: 0;">
                <!-- {{plusRow(row.subTotal,row.vatTax,row.discount) | currency:'VND':''}} -->
                {{row.amount | currency:'VND':''}}
              </div>
              <div class="col-right" style="padding-right: 0;">
                <span style="color: #ed7d31"> {{row.payType}}</span>
              </div>
            </ng-template>
          </ngx-datatable-column>
          <ngx-datatable-column [width]="40" [sortable]="false" [canAutoResize]="false" [draggable]="false"
            [resizeable]="false" name="" [cellClass]="'col-action'" [headerClass]="'col-action'">

            <ng-template let-row="row" ngx-datatable-cell-template let-isSelected="isSelected">
              <div class="icon-actions">
                <div class="actions">
                  <a style="margin-left: 2px;" class="icon-action">
                    <span class="icon-printer"></span>
                  </a>
                </div>
                <div class="actions">
                  <a class="icon-action" [hidden] = "authenticationService.hasPermission('Money Receipt','delete')" (click)="delete(row.id,row.receiptNumber)">
                    <span class="icon-delete"></span>
                  </a>
                </div>
              </div>
            </ng-template>
          </ngx-datatable-column>
          <ngx-datatable-footer>
            <ng-template ngx-datatable-footer-template let-rowCount="rowCount" let-pageSize="pageSize"
              let-selectedCount="selectedCount" let-curPage="curPage" let-offset="offset" let-isVisible="isVisible">
              <div class="row" style="display: inline-block;width: 100%;border-top: 1px solid #ccc;padding-top: 3px; margin-top:-20px;">
                <div class="row text-right col-12">
                  <div class="col-3 text-center">
                    <b>Total: {{rowCount}} items </b>
                  </div>
                  <div class="col-3"></div>
                  <div class="col-3 text-center">
                    <b>{{'BUY.INVOICE.GRID.GRANT.TOTAL' | translate}}</b>
                  </div>
                  <div class="col-3 pr-3">
                    <b>{{getGrantTotal()| currency:'VND':''}}</b>
                  </div>
                </div>
                <div class="row">
                  <div class="page-count col-md-6 pl-4">
                  </div>
                  <div class="col-md-6 text-right">
                    <datatable-pager [pagerLeftArrowIcon]="'datatable-icon-left'"
                      [pagerRightArrowIcon]="'datatable-icon-right'" [pagerPreviousIcon]="'datatable-icon-prev'"
                      [pagerNextIcon]="'datatable-icon-skip'" [count]="rowCount" [page]="curPage" [size]="pageSize"
                      [hidden]="!((rowCount / pageSize) > 1)" (change)="myTable.onFooterPage($event)">
                    </datatable-pager>
                  </div>
                </div>
              </div>
            </ng-template>
          </ngx-datatable-footer>
        </ngx-datatable>
        </div>
      </div>
  </nb-card-body>
</nb-card>
